<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MRSS Viewer – Full Item Details</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f7f7f7;
    margin: 0;
    padding: 20px;
  }
  h1 {
    font-size: 24px;
    margin-bottom: 5px;
  }
  #feedTitle {
    font-size: 14px;
    color: #555;
    margin-bottom: 20px;
  }
  #status {
    font-size: 14px;
    color: #666;
    margin-bottom: 15px;
    white-space: pre-wrap;
  }
  .item {
    background: #ffffff;
    padding: 16px;
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  }
  .item-header {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
  }
  .thumb-wrapper {
    flex: 0 0 180px;
  }
  .thumb-wrapper img {
    max-width: 180px;
    border-radius: 6px;
    display: block;
  }
  .item-main {
    flex: 1;
    min-width: 220px;
  }
  .item-title {
    font-size: 18px;
    margin: 0 0 4px;
  }
  .item-title a {
    text-decoration: none;
    color: #222;
  }
  .item-title a:hover {
    text-decoration: underline;
  }
  .meta-row {
    font-size: 13px;
    color: #555;
    margin-bottom: 4px;
  }
  .label {
    font-weight: bold;
  }
  .description {
    margin-top: 10px;
    font-size: 14px;
    color: #333;
  }
  .chips {
    margin-top: 8px;
  }
  .chip {
    display: inline-block;
    background: #eef2ff;
    color: #334155;
    border-radius: 999px;
    padding: 3px 8px;
    font-size: 12px;
    margin-right: 6px;
    margin-bottom: 4px;
  }
  .section-title {
    margin-top: 12px;
    font-size: 13px;
    font-weight: bold;
    color: #444;
  }
  .content-list {
    font-size: 13px;
    margin: 4px 0 0 0;
    padding-left: 16px;
  }
  .content-list li {
    margin-bottom: 4px;
    word-break: break-all;
  }
  .link {
    font-size: 13px;
    word-break: break-all;
  }
</style>
</head>
<body>

<h1>MRSS Viewer</h1>
<div id="feedTitle"></div>
<div id="status">Loading…</div>
<div id="feed"></div>

<script>
// ---- CONFIG ----

// Your MRSS feed URL:
const MRSS_URL = "https://d2fwyiosgzln2d.cloudfront.net/superannuation.mrss";

// Use a public CORS proxy so the browser can fetch the MRSS XML.
// If this ever stops working, the error message on the page will say "Failed to fetch".
const FETCH_URL = "https://corsproxy.io/?" + encodeURIComponent(MRSS_URL);

// ----------------

const statusEl = document.getElementById("status");
const feedEl   = document.getElementById("feed");
const feedTitleEl = document.getElementById("feedTitle");

function getText(parent, selector) {
  const el = parent.querySelector(selector);
  return el ? el.textContent.trim() : "";
}

function parseAndRender(xmlText) {
  const doc = new window.DOMParser().parseFromString(xmlText, "application/xml");

  // Feed title (channel > title)
  const channelTitle = getText(doc, "channel > title");
  feedTitleEl.textContent = channelTitle ? `Feed title: ${channelTitle}` : "";

  const items = doc.querySelectorAll("item");
  feedEl.innerHTML = "";
  statusEl.textContent = "";

  if (!items.length) {
    statusEl.textContent = "No <item> elements found in MRSS feed.";
    return;
  }

  items.forEach(item => {
    const title   = getText(item, "title") || "No title";
    const link    = getText(item, "link");
    const desc    = getText(item, "description");
    const pubDate = getText(item, "pubDate");
    const guid    = getText(item, "guid");

    // Thumbnail
    const mediaThumb = item.querySelector("media\\:thumbnail, thumbnail");
    const thumbUrl   = mediaThumb ? mediaThumb.getAttribute("url") : "";

    // media:keywords
    const mediaKeywordsEl = item.querySelector("media\\:keywords");
    let keywords = [];
    if (mediaKeywordsEl && mediaKeywordsEl.textContent) {
      keywords = mediaKeywordsEl.textContent
        .split(",")
        .map(k => k.trim())
        .filter(Boolean);
    }

    // media:category (can be multiple)
    const mediaCategoryEls = item.querySelectorAll("media\\:category");
    const categories = Array.from(mediaCategoryEls)
      .map(c => c.textContent.trim())
      .filter(Boolean);

    // media:content entries
    const mediaContents = item.querySelectorAll("media\\:content");

    // Build card
    const card = document.createElement("div");
    card.className = "item";

    const header = document.createElement("div");
    header.className = "item-header";

    // Thumbnail column
    if (thumbUrl) {
      const thumbWrap = document.createElement("div");
      thumbWrap.className = "thumb-wrapper";

      const img = document.createElement("img");
      img.src = thumbUrl;
      img.loading = "lazy";
      thumbWrap.appendChild(img);
      header.appendChild(thumbWrap);
    }

    // Main column
    const main = document.createElement("div");
    main.className = "item-main";

    const titleEl = document.createElement("h2");
    titleEl.className = "item-title";

    if (link) {
      const a = document.createElement("a");
      a.href = link;
      a.target = "_blank";
      a.rel = "noopener noreferrer";
      a.textContent = title;
      titleEl.appendChild(a);
    } else {
      titleEl.textContent = title;
    }
    main.appendChild(titleEl);

    if (link) {
      const linkRow = document.createElement("div");
      linkRow.className = "meta-row";
      const label = document.createElement("span");
      label.className = "label";
      label.textContent = "Link: ";
      linkRow.appendChild(label);

      const linkEl = document.createElement("a");
      linkEl.href = link;
      linkEl.target = "_blank";
      linkEl.rel = "noopener noreferrer";
      linkEl.textContent = link;
      linkEl.className = "link";

      linkRow.appendChild(linkEl);
      main.appendChild(linkRow);
    }

    if (pubDate) {
      const dateRow = document.createElement("div");
      dateRow.className = "meta-row";
      dateRow.innerHTML = `<span class="label">pubDate:</span> ${pubDate}`;
      main.appendChild(dateRow);
    }

    if (guid) {
      const guidRow = document.createElement("div");
      guidRow.className = "meta-row";
      guidRow.innerHTML = `<span class="label">guid:</span> ${guid}`;
      main.appendChild(guidRow);
    }

    // Description
    if (desc) {
      const descEl = document.createElement("div");
      descEl.className = "description";
      descEl.innerHTML = `<span class="label">Description:</span> ${desc}`;
      main.appendChild(descEl);
    }

    // Keywords & categories as chips
    if (keywords.length || categories.length) {
      const chipsWrap = document.createElement("div");
      chipsWrap.className = "chips";

      if (keywords.length) {
        keywords.forEach(k => {
          const chip = document.createElement("span");
          chip.className = "chip";
          chip.textContent = `#${k}`;
          chipsWrap.appendChild(chip);
        });
      }

      if (categories.length) {
        categories.forEach(c => {
          const chip = document.createElement("span");
          chip.className = "chip";
          chip.textContent = c;
          chipsWrap.appendChild(chip);
        });
      }

      main.appendChild(chipsWrap);
    }

    // media:content list
    if (mediaContents.length) {
      const sectionTitle = document.createElement("div");
      sectionTitle.className = "section-title";
      sectionTitle.textContent = "media:content entries:";
      main.appendChild(sectionTitle);

      const ul = document.createElement("ul");
      ul.className = "content-list";

      mediaContents.forEach(mc => {
        const li = document.createElement("li");

        const url = mc.getAttribute("url") || "";
        const type = mc.getAttribute("type") || "";
        const medium = mc.getAttribute("medium") || "";
        const width = mc.getAttribute("width") || "";
        const height = mc.getAttribute("height") || "";
        const fileSize = mc.getAttribute("fileSize") || "";
        const duration = mc.getAttribute("duration") || "";
        const bitrate = mc.getAttribute("bitrate") || "";

        const parts = [];
        if (url) parts.push(`url: ${url}`);
        if (type) parts.push(`type: ${type}`);
        if (medium) parts.push(`medium: ${medium}`);
        if (width || height) parts.push(`size: ${width}x${height}`);
        if (fileSize) parts.push(`fileSize: ${fileSize}`);
        if (duration) parts.push(`duration: ${duration}`);
        if (bitrate) parts.push(`bitrate: ${bitrate}`);

        li.textContent = parts.join(" | ");
        ul.appendChild(li);
      });

      main.appendChild(ul);
    }

    header.appendChild(main);
    card.appendChild(header);
    feedEl.appendChild(card);
  });
}

async function loadFeed() {
  try {
    statusEl.textContent = "Loading MRSS via proxy…";
    const res = await fetch(FETCH_URL);
    if (!res.ok) {
      throw new Error(`HTTP ${res.status}`);
    }
    const text = await res.text();
    parseAndRender(text);
    statusEl.textContent = "Loaded.";
  } catch (err) {
    console.error("MRSS load error:", err);
    statusEl.textContent = "Error loading MRSS feed: " + (err.message || err);
  }
}

loadFeed();
</script>

</body>
</html>
